---
title: '使用示例'
description: ''
---

以下是调整后的接口使用流程，将前置条件和使用规范放在最前面，示例部分随后展示。

## API 使用流程

### 1. 完成前置条件
- 在进行聊天之前，确保已完成以下步骤：
  1. **获取API密钥**：向服务提供商申请并获取API密钥，以便进行身份验证。
  2. **创建数据库链接（如有必要）**：为了确保数据的安全，建议创建新的数据库用户，并为其分配合适的权限。这样可以限制对数据库的访问，降低潜在的安全风险。
  3. **创建会话**：在进行聊天之前，需创建一个会话以便于管理和跟踪用户的聊天记录。

通过遵循以上步骤，用户可以确保在使用API时保护其数据安全，同时顺利进行后续的聊天操作。

### 2. 使用规范
#### 状态码说明
- **200**: 请求成功
- **400**: 请求参数错误
- **401**: 未授权（密钥错误）
- **404**: 资源未找到
- **500**: 服务器内部错误

#### 返回数据状态码说明
- **600**: 响应成功
- **700**: 响应失败
- **601**: 表示流程执行过程的信息（流式响应）
- **602**: 流式对话内容输出的正文内容（流式响应）
- **603**: 图表数据和生成的图表图片数据（流式响应）

#### 默认参数位置
- 所有请求的API密钥应通过请求头传递：
  - `x-api-key`: 密钥

### 3. 获取密钥
- 在使用API之前，请查看**说明**获取API密钥。该密钥用于身份验证。

### 4. 数据库相关接口
#### 4.1 创建数据库链接
- **接口**: `POST /api/v1/databases`
- **请求体**:
  ```json
  {
      "name": "example_name",
      "description": "this is a knowledge base",
      "prompt": "",
      "database_name": "library",
      "database_type": "example_db",
      "hostname": "localhost",
      "port": 5432,
      "username": "postgres",
      "password": "password"
  }
  ```

#### 4.2 获取数据库链接
- **接口**: `GET /api/v1/databases/{database_id}`
- **请求参数**: `database_id`

#### 4.3 修改数据库链接
- **接口**: `PUT /api/v1/databases/{database_id}`
- **请求体**:
  ```json
  {
      "name": "new_name",
      "description": "this is a knowledge base",
      "prompt": "you are a useful assistant.",
      "database_name": "new_database_name",
      "database_type": "postgresql",
      "hostname": "localhost",
      "port": 5432,
      "username": "new_user",
      "password": "new_password"
  }
  ```

#### 4.4 断开与数据库链接
- **接口**: `DELETE /api/v1/databases/{database_id}`
- **请求参数**: `database_id`

#### 4.5 检查数据库链接状态
- **接口**: `GET /api/v1/databases/{database_id}/connection_status`
- **请求参数**: `database_id`

### 5. 会话相关接口
#### 5.1 创建会话
- **接口**: `POST /api/v1/conversation`
- **请求体**:
  ```json
  {
      "database_id": "数据库的唯一标识符",
      "name": "会话名称"
  }
  ```

#### 5.2 获取会话信息
- **接口**: `GET /api/v1/conversation/{conversation_id}`
- **请求参数**: `conversation_id`

#### 5.3 获取用户指定数据库的会话列表
- **接口**: `GET /api/v1/conversation/list/data`
- **请求参数**: `database_id`

#### 5.4 删除会话
- **接口**: `DELETE /api/v1/conversation/{conversation_id}`
- **请求参数**: `conversation_id`

### 6. 聊天相关接口
#### 6.1 聊天
- **接口**: `POST /api/v1/chat`
- **请求体**:
  ```json
  {
      "text": "你的问题",
      "session_id": "会话ID"
  }
  ```

#### 6.2 流式聊天
- **接口**: `POST /api/v1/chat/stream`
- **请求体**:
  ```json
  {
      "text": "你的问题",
      "session_id": "会话ID"
  }
  ```

